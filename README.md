# A parsimonious climate envelope model for the global projection of aboveground biomass in the future

This directory contains the code to reproduce the method and results presented in the manuscript. The code is structured in modules where the methods performing the heavy-duty work are defined and documented (.py files). These methods are used in the **method.ipynb** interactive notebook, where all the steps to rerproduce the method can be executed. We hope this improves readability and understandability of the method steps, while still allowing to refer to the modules for specific details about the functions. Above each notebook cell, we provide an estimated computing time in a modern PC. The full method should run in about 24 hours, but could be faster. The rest of Jupyter notebooks contain the code to reproduce the analysis and figures presented in the manuscript and in the supplementary material.  

We provide the specifications of the conda environment needed to reproduce the method in **environment.yml**. Executing the command: **conda env create -f environment.yml** should import the proper configuration. We used Miniforge installer (https://github.com/conda-forge/miniforge). 

The script **merge_agbd_tiles.py** serves the purpose of merging tiles with AGBD predictions in a single raster file. The function is already implemented in the **method.ipynb** notebook but it requires a lot of RAM (recommended 32-64GB). In case your computer is at the limit, attempting to merge rasters outside of a Jupyter notebook and directly by running a Python scritp from a terminal can spare enough memory to finalize the process. 

The method is written in Python and mostly uses Python libraries, still biomass calculation is done with allometric relaitonships featured in R packages BIOMASS and allodb. For a smoother integration in the workflow, we adapted part of the notebook to be able to call R scripts from within. The R script that is called and which contains the code for biomass calculation is stored within the R directory: **./R/AGB_calculation.R**.

Model calibration (i.e. hyper-parameter tuning and predictor selection) was carried over using OpenMOLE model exploration software and running simulations in a High Performance Computing (HPC) infrastructure. In an HPC infrastructure using 120 parallel cores, calibration might take 24-48 hours before converging and error estimation 7-10 days. We did not included the calibration procedure in the main notebook but provide the files with the results from the experiments we ran. Still, we provide all the code needd to run the calibration experiment within the **./model_calibration/** directory. This needs the installation of OpenMOLE. In that directory we provide a specific README file with the instructions to reproduce the analysis.